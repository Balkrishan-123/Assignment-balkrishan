//Created by Balkrishan sharma
//07-01-26
import UIKit

class DoctorTableViewCell: UITableViewCell {
    
    static let identifier = "DoctorTableViewCell"
    
    // MARK: - UI Components
    private let containerView: UIView = {
        let view = UIView()
        view.backgroundColor = .white
        view.layer.cornerRadius = 12
        view.layer.shadowColor = UIColor.gray.cgColor
        view.layer.shadowOpacity = 0.2
        view.layer.shadowOffset = CGSize(width: 0, height: 2)
        view.layer.shadowRadius = 5
        view.translatesAutoresizingMaskIntoConstraints = false
        return view
    }()
    
    private let avatarView: UIView = {
        let view = UIView()
        view.backgroundColor = UIColor.systemBlue.withAlphaComponent(0.2)
        view.layer.cornerRadius = 25
        view.translatesAutoresizingMaskIntoConstraints = false
        return view
    }()
    
    private let
    private let emailLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 15)
        label.textColor = .gray
        label.translatesAutoresizingMaskIntoConstraints = false
        return label
    }()
    
    private let genderBadge: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 12, weight: .medium)
        label.textColor = .white
        label.textAlignment = .center
        label.layer.cornerRadius = 12
        label.layer.masksToBounds = true
        label.translatesAutoresizingMaskIntoConstraints = false
        return label
    }()
    
    private let dividerView: UIView = {
        let view = UIView()
        view.backgroundColor = .separator
        view.translatesAutoresizingMaskIntoConstraints = false
        return view
    }()
    
    private let idLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 12)
        label.textColor = .secondaryLabel
        label.translatesAutoresizingMaskIntoConstraints = false
        return label
    }()
    
    private let ageLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 12)
        label.textColor = .secondaryLabel
        label.translatesAutoresizingMaskIntoConstraints = false
        return label
    }()
    
    private let phoneLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 12)
        label.textColor = .secondaryLabel
        label.translatesAutoresizingMaskIntoConstraints = false
        return label
    }()
    
    private let idIcon: UIImageView = {
        let imageView = UIImageView()
        imageView.image = UIImage(systemName: "person.text.rectangle")
        imageView.tintColor = .secondaryLabel
        imageView.contentMode = .scaleAspectFit
        imageView.translatesAutoresizingMaskIntoConstraints = false
        return imageView
    }()
    
    private let ageIcon: UIImageView = {
        let imageView = UIImageView()
        imageView.image = UIImage(systemName: "calendar")
        imageView.tintColor = .secondaryLabel
        imageView.contentMode = .scaleAspectFit
        imageView.translatesAutoresizingMaskIntoConstraints = false
        return imageView
    }()
    
    private let phoneIcon: UIImageView = {
        let imageView = UIImageView()
        imageView.image = UIImage(systemName: "phone.fill")
        imageView.tintColor = .secondaryLabel
        imageView.contentMode = .scaleAspectFit
        imageView.translatesAutoresizingMaskIntoConstraints = false
        return imageView
    }()
    
    // MARK: - Initializers
    override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) {
        super.init(style: style, reuseIdentifier: reuseIdentifier)
        setupViews()
    }
    
    required init?(coder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
    // MARK: - Setup
    private func setupViews() {
        backgroundColor = .clear
        selectionStyle = .none
        
        contentView.addSubview(containerView)
        
        avatarView.addSubview(avatarLabel)
        containerView.addSubview(avatarView)
        containerView.addSubview(nameLabel)
        containerView.addSubview(emailLabel)
        containerView.addSubview(genderBadge)
        containerView.addSubview(dividerView)
        containerView.addSubview(idIcon)
        containerView.addSubview(idLabel)
        containerView.addSubview(ageIcon)
        containerView.addSubview(ageLabel)
        containerView.addSubview(phoneIcon)
        containerView.addSubview(phoneLabel)
        
        NSLayoutConstraint.activate([
            containerView.topAnchor.constraint(equalTo: contentView.topAnchor, constant: 4),
            containerView.leadingAnchor.constraint(equalTo: contentView.leadingAnchor, constant: 16),
            containerView.trailingAnchor.constraint(equalTo: contentView.trailingAnchor, constant: -16),
            containerView.bottomAnchor.constraint(equalTo: contentView.bottomAnchor, constant: -4),
            
            avatarView.leadingAnchor.constraint(equalTo: containerView.leadingAnchor, constant: 16),
            avatarView.topAnchor.constraint(equalTo: containerView.topAnchor, constant: 16),
            avatarView.widthAnchor.constraint(equalToConstant: 50),
            avatarView.heightAnchor.constraint(equalToConstant: 50),
            
            avatarLabel.centerXAnchor.constraint(equalTo: avatarView.centerXAnchor),
            avatarLabel.centerYAnchor.constraint(equalTo: avatarView.centerYAnchor),
            
            nameLabel.leadingAnchor.constraint(equalTo: avatarView.trailingAnchor, constant: 12),
            nameLabel.topAnchor.constraint(equalTo: containerView.topAnchor, constant: 16),
            nameLabel.trailingAnchor.constraint(lessThanOrEqualTo: genderBadge.leadingAnchor, constant: -8),
            
            emailLabel.leadingAnchor.constraint(equalTo: nameLabel.leadingAnchor),
            emailLabel.topAnchor.constraint(equalTo: nameLabel.bottomAnchor, constant: 4),
            emailLabel.trailingAnchor.constraint(lessThanOrEqualTo: genderBadge.leadingAnchor, constant: -8),
            
            genderBadge.trailingAnchor.constraint(equalTo: containerView.trailingAnchor, constant: -16),
            genderBadge.centerYAnchor.constraint(equalTo: avatarView.centerYAnchor),
            genderBadge.widthAnchor.constraint(greaterThanOrEqualToConstant: 60),
            genderBadge.heightAnchor.constraint(equalToConstant: 24),
            
            dividerView.topAnchor.constraint(equalTo: avatarView.bottomAnchor, constant: 12),
            dividerView.leadingAnchor.constraint(equalTo: containerView.leadingAnchor, constant: 16),
            dividerView.trailingAnchor.constraint(equalTo: containerView.trailingAnchor, constant: -16),
            dividerView.heightAnchor.constraint(equalToConstant: 1),
            
            // ID Section (Left side)
            idIcon.leadingAnchor.constraint(equalTo: containerView.leadingAnchor, constant: 16),
            idIcon.topAnchor.constraint(equalTo: dividerView.bottomAnchor, constant: 12),
            idIcon.widthAnchor.constraint(equalToConstant: 16),
            idIcon.heightAnchor.constraint(equalToConstant: 16),
            
            idLabel.leadingAnchor.constraint(equalTo: idIcon.trailingAnchor, constant: 4),
            idLabel.centerYAnchor.constraint(equalTo: idIcon.centerYAnchor),
            idLabel.trailingAnchor.constraint(lessThanOrEqualTo: ageIcon.leadingAnchor, constant: -12),
            
            // Age Section (Middle)
            ageIcon.leadingAnchor.constraint(equalTo: idLabel.trailingAnchor, constant: 12),
            ageIcon.centerYAnchor.constraint(equalTo: idIcon.centerYAnchor),
            ageIcon.widthAnchor.constraint(equalToConstant: 16),
            ageIcon.heightAnchor.constraint(equalToConstant: 16),
            
            ageLabel.leadingAnchor.constraint(equalTo: ageIcon.trailingAnchor, constant: 4),
            ageLabel.centerYAnchor.constraint(equalTo: ageIcon.centerYAnchor),
            ageLabel.trailingAnchor.constraint(lessThanOrEqualTo: phoneIcon.leadingAnchor, constant: -12),
            
            // Phone Section (Right side)
            phoneIcon.leadingAnchor.constraint(greaterThanOrEqualTo: ageLabel.trailingAnchor, constant: 12),
            phoneIcon.centerYAnchor.constraint(equalTo: idIcon.centerYAnchor),
            phoneIcon.widthAnchor.constraint(equalToConstant: 16),
            phoneIcon.heightAnchor.constraint(equalToConstant: 16),
            phoneIcon.trailingAnchor.constraint(equalTo: phoneLabel.leadingAnchor, constant: -4),
            
            phoneLabel.trailingAnchor.constraint(equalTo: containerView.trailingAnchor, constant: -16),
            phoneLabel.centerYAnchor.constraint(equalTo: idIcon.centerYAnchor),
            phoneLabel.bottomAnchor.constraint(equalTo: containerView.bottomAnchor, constant: -12)
        ])
    }
    
    // MARK: - Configuration
    func configure(with doctor: Doctor) {
        // Avatar
        avatarLabel.text = String(doctor.name.prefix(1).uppercased())
        
        // Name and Email
        nameLabel.text = doctor.name
        emailLabel.text = doctor.email ?? "No email"
        
        if doctor.email == nil || doctor.email?.isEmpty == true {
            emailLabel.textColor = .lightGray
        } else {
            emailLabel.textColor = .gray
        }
        
        // Gender Badge
        if let gender = doctor.gender {
            let genderText: String
            let backgroundColor: UIColor
            
            switch gender {
            case "M":
                genderText = "Male"
                backgroundColor = .systemBlue
            case "F":
                genderText = "Female"
                backgroundColor = .systemPink
            default:
                genderText = "Other"
                backgroundColor = .systemPurple
            }
            
            genderBadge.text = genderText
            genderBadge.backgroundColor = backgroundColor
            genderBadge.isHidden = false
        } else {
            genderBadge.isHidden = true
        }
        
        // Bottom info
        idLabel.text = "ID: \(doctor.id)"
        
        if let age = doctor.age, let ageUnit = doctor.ageUnit {
            ageLabel.text = "Age: \(age) \(ageUnit)"
            ageLabel.isHidden = false
            ageIcon.isHidden = false
        } else {
            ageLabel.isHidden = true
            ageIcon.isHidden = true
        }
        
        if let phone = doctor.phoneNo, !phone.isEmpty {
            phoneLabel.text = phone
            phoneLabel.isHidden = false
            phoneIcon.isHidden = false
        } else {
            phoneLabel.isHidden = true
            phoneIcon.isHidden = true
        }
    }
}
